#!/usr/bin/env perl
use strict;
use warnings;
use IO::File;
use Data::Dumper;
use Time::HiRes qw(gettimeofday tv_interval);
use Getopt::Long;
use Carp;
use lib qw(lib);
use palign qw(readfa hash align attach detach report);

my $opts = {};
GetOptions($opts, qw(k=s index=s query report));
if($opts->{k}) {
    $palign::k = $opts->{k};
}

if(!$opts->{index}) {
  $opts->{index} = 'index.stbl';
}

my $t0 = [gettimeofday];
my @inputs = @ARGV;

attach($opts->{index} || 'index.stbl');

if($opts->{report}) {
  report();
  exit 0;
}

if($opts->{query}) {
    readfa(\&align, @inputs);
    print "Aligned in @{[tv_interval $t0]} secs\n";
    detach();
    exit 0;
}

if($opts->{index}) {
    readfa(\&hash, @inputs);
    print "Built hashtable in @{[tv_interval $t0]} secs\n";
    detach();
    exit 0;
}
